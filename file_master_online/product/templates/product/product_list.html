{% extends 'product/base.html' %}

{% block content %}

{% if user.is_authenticated %}
    {% for product in products %}
    <div>
        <h1><a id="product" href="{% url 'product_detail' pk=product.pk %}">{{ product.name }}</a></h1>
        <button type="button" class="btn btn-danger" href= "{% url 'product_erase' pk=product.pk %}" onclick="callModal(event)" style="float: left; margin-top: -42px; margin-left: 550px; ">Delete </button>
    </div>
    {% endfor %}
    {% else %}
    <a href="{% url 'login' %}">login</a>
{% endif %}

<script>
    var url = ""
    function callModal(event){
        var target=$(event.target);
        url = target.attr("href");
        var parent = $(target).parent()
        var firstElem = parent[0].firstElementChild
        var children = firstElem.children[0]
        var name_prod = children.innerText 
        $('.modal-title').text('DELETE '+name_prod)
        $('#myModal').modal('show');
    }
</script>

<!-- Modal -->
<div class="modal fade" id="myModal" role="dialog">
        <script>
            // on load of modal
            $('#myModal').on('show.bs.modal', function () {
                // do somethingâ€¦
                var htmlForm = document.getElementById('eraseForm')
                htmlForm.action = url
            })
        </script>
    
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title"></h4>
                </div>
                <div class="modal-body">
                    <p>Delete this product and all his history?</p>
                    <p>THIS ACTION IS IRREVERSIBLE</p>
                </div>
                <div class="modal-footer">
                    <form action="" method="post" id="eraseForm">
                            {% csrf_token %}
                    <input class="btn btn-danger" type="submit" value="Delete" >  
                    </form> 
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}