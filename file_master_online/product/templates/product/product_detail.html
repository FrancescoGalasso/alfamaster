{% extends 'product/base.html' %} 
{% block content %}

<hr/>

{% comment %}
Loop through the dictionary's items to get the keys and values:
  for key, value in test.items
{% endcomment %}
{% comment %}
<h2>{{prod_name}}</h2>
{% for itemlists in list %}
<ul>
  {% for k,v in itemlists.items %}
  <li>
    {% if k != "bases" %}
    <a href="#">{{ k }} : {{v}}</a>
    {% else %}
    {%for element in v%}
    <p>base name: {{ element.name}}</p>
    <p>base %w/w: {{ element.g_100g}}</p>
    {% endfor %}
    {% endif %}
  </li>
  {% endfor %}
</ul>
{% endfor %}
{% endcomment %}

<!-- <style>

  table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
    }
</style> -->

<!-- script -->
<script type="text/javascript">
  var foo = [];
  var foo2 = [];
  var element_name = [];
  var max_of_array = 0;
</script>

<h2>{{prod_name}}</h2>

<table class="display" style="width:100%">
                  <!-- thead -->
    <thead>
        <tr>
            <th style="visibility:hidden;"></th>
            <th style="visibility:hidden;"></th>
            <th style="visibility:hidden;"></th>
            {% for itemlists in list %} 
              {% for k,v in itemlists.items %}
                {% if k == "bases" %}
                  {%for element in v%}
                        <!-- script -->
                    <script type="text/javascript">
                        a = "{{element.name}}";
                        if(!foo.includes(a)){
                          foo.push(a);
                          console.log(a);
                          $("tr:nth-child(1)").first().append("<th colspan='5'>{{element.name}}</th>");
                        }
                    </script>
                  {% endfor %} 
                {% endif %}
              {% endfor %}
            {% endfor %}
        </tr>
        <tr>
            <th>Raw material</th>
            <th>Specific weight [g/mL]</th>
            <th>RM cost [$/L]</th>

            {% for itemlists in list %}
                {% for k,v in itemlists.items %}
                  {% if k == "bases" %}
                    <!-- script -->
                    <script type="text/javascript"> 
                      a = "{{v|length}}";
                      foo2.push(a);
                      console.log(foo2);
                      max_of_array = Math.max.apply(Math, foo2);
                      console.log(max_of_array);
                    </script>
                  {% endif %}
                {% endfor %}
              {% endfor %}
               <!-- script --> 
              <script>
                var i;
                for (i = 0; i < max_of_array; i++) { 
                  $("tr:nth-child(2)").append("<th>%w/w</th>");
                  $("tr:nth-child(2)").append(" <th>mL/100g</th>");
                  $("tr:nth-child(2)").append("<th>%v/v</th>");
                  $("tr:nth-child(2)").append("<th>mL/1000g</th>");
                  $("tr:nth-child(2)").append("<th>Formula Cost [$/L]</th>");     
                }
              </script>
        </tr>
    </thead>
                  <!-- tbody -->
    <tbody>
        {% for itemlists in list %} 
        <tr>
          {% for k,v in itemlists.items %}
            {% if k != "bases" %}
            <td>{{v}}</td>
            {% endif %}
          {% endfor %}
                  <!-- show the bases -->
          {% for k,v in itemlists.items %}
            {% if k == "bases" %}
              {%for element in v%}
                <td>{{element.g_100g}}</td>
                <td>{{element.ml_100g}}</td>
                <td>{{element.v_100v}}</td>
                <td>{{element.ml_1000ml}}</td>
                <td>{{element.formula_cost}}</td>
              {% endfor %} 
            {% endif %}
          {% endfor %}
        {% endfor %}
        </tr>
    </tbody>
                  <!-- footer -->
    <tfoot>
        <th style="visibility:hidden;"></th>
        <th style="visibility:hidden;"></th>
        <th style="visibility:hidden;"></th>
        {% for itemlists in list %} 
          {% for k,v in itemlists.items %}
            {% if k == "bases" %}
              {%for element in v%}
              <th style="visibility:hidden;"></th>
              {% endfor %} 
            {% endif %}
          {% endfor %}
        {% endfor %}
    </tfoot>
</table>

<hr/>

{% comment %}
<h2>{{prod_name}}</h2>
  
      <table class="table table-condensed table-bordered table-hover">
          <thead>
            <tr>
              <th class="col-md-1">Raw material</th>
              <th class="col-md-1">Specific weight [g/mL]</th>
              <th class="col-md-1">RM cost [$/L]</th>
              {% for itemlists in list %}
                {% for k,v in itemlists.items %}
                  {% if k == "bases" %}
                    {%for element in v%}
                    <!-- <p>{{ forloop.counter }}: {{ element }}</p> -->
                    <th>%w/w</th>
                    <th>mL/100g</th>
                    <th>%v/v</th>
                    <th>mL/1000g</th>
                    <th>Formula Cost [$/L]</th>
                    {% endfor %}
                  {% endif %}
                {% endfor %}
              {% endfor %} 
            </tr>
          </thead>
          <tbody>

                {% for itemlists in list %} 
                <!-- <script type="text/javascript"> 
                  var a = "{{itemlists|safe}}";
                  console.log(a);
               </script> -->
                <tr>
                {% for k,v in itemlists.items %}
                {% if k != "bases" %}
                <td>{{v}}</td>
                <!-- <script type="text/javascript"> 
                  var a = "{{v}}";
                  console.log(a);
               </script> -->
                {% endif %}
                {% endfor %}
                {% for k,v in itemlists.items %}
                {% if k == "bases" %}
                      <thead>
                        <tr>
                          <th>Name</th>
                          <th>%w/w</th>
                          <th>mL/100g</th>
                          <th>%v/v</th>
                          <th>mL/1000g</th>
                          <th>Formula Cost [$/L]</th>
                        </tr>
                      </thead>
                {% endif %}
                {% endfor %}
              <!-- </tr> -->
                {% endfor %}
              </tr>
          </tbody>
        </table>

        <!-- <script>
        $(document).ready(function() {
          $('#example').DataTable( {
              scrollY:        '50vh',
              scrollCollapse: true,
              paging:         false
          } );
      } );
        </script> -->

{% endcomment %}

{% endblock %}