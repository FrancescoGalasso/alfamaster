{% extends 'product/base.html' %} 
{% block content %}
{% load staticfiles %}

<!-- script -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script type="text/javascript">
  var foo = [];
  var foo2 = [];
  var element_name = ['Base 1 (Pastel)', 'TiO2 Slurry', 'Base 2', 'Base 3', 'Base4', 'Base5', 'Base6', 'Base7', 'Base8', 'Base9'];
  var max_of_array = 0;
  var num = 0
  var pk = '{{prod_pk}}'
  var rev = '{{prod_rev}}'
  var bases_num = 0
  var revv = String(rev)
  var currency = '{{prod_currency}}'
</script>

<h2>{{prod_name}}</h2>

<table class="display" style="width:100%" id="tdetail">
                  <!-- thead -->
    <thead>
        <tr>
            <th style="visibility:hidden;"></th>
            <th style="visibility:hidden;"></th>
            <th style="visibility:hidden;"></th>
            {% for itemlists in list %} 
              {% for k,v in itemlists.items %}
                {% if k == "bases" %}
                  <script type="text/javascript">
                    bases_num = "{{v|length}}"
                  </script>
                {% endif %}
              {% endfor %}
            {% endfor %}
        </tr>
        <tr>
            <th>Raw material</th>
            <th>Specific weight [g/mL]</th>
            <th>RM cost [{{prod_currency}}/Kg]</th>

            {% for itemlists in list %}
                {% for k,v in itemlists.items %}
                  {% if k == "bases" %}
                    <!-- script -->
                    <script type="text/javascript"> 
                      a = "{{v|length}}";
                      foo2.push(a);
                      max_of_array = Math.max.apply(Math, foo2);
                    </script>
                  {% endif %}
                {% endfor %}
              {% endfor %}
               <!-- script --> 
              <script>
                var i;
                for (i = 0; i < max_of_array; i++) { 
                  $("tr:nth-child(2)").append("<th>%w/w</th>");
                  $("tr:nth-child(2)").append(" <th>mL/100g</th>");
                  $("tr:nth-child(2)").append("<th>%v/v</th>");
                  $("tr:nth-child(2)").append("<th>mL/1000g</th>");
                  $("tr:nth-child(2)").append("<th>Formula Cost ["+currency+"/L]</th>");     
                }
              </script>
        </tr>
    </thead>
                  <!-- tbody -->
    <tbody>
        {% for itemlists in list %} 
        <tr>
          {% for k,v in itemlists.items %}
            {% if k != "bases" %}
            <td>{{v}}</td>
            {% endif %}
          {% endfor %}
                  <!-- show the bases -->
          {% for k,v in itemlists.items %}
            {% if k == "bases" %}
              {%for element in v%}
                <td>{{element.g_100g}}</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
              {% endfor %} 
            {% endif %}
          {% endfor %}
        {% endfor %}
        </tr>
    </tbody>
                  <!-- footer -->
</table>

<div id="myGeneratedTable"></div>
<div id="tableFillCalculation"></div>
<br>
<div id="tableMaster"></div>
<br>
<script src="{% static 'js/grid.js' %}"></script>  
<script src="{% static 'js/utils.js' %}"></script>
<script>  
  for(var i=0; i<bases_num; i++){
    $("tr:nth-child(1)").first().append("<th colspan='5'>"+element_name[i]+"</th>");
  }
</script>
<hr/>

<!-- Modal -->
<div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">DELETE {{prod_name}}</h4>
        </div>
        <div class="modal-body">
          <p>Delete this last revision of this product?</p>
        </div>
        <div class="modal-footer">
            <form action="{% url 'product_delete' pk=prod_pk %}" method="post">
                {% csrf_token %}
                <input class="btn btn-danger" type="submit" value="Delete">
            </form>
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>

        </div>
      </div>
      
    </div>
  </div>

  <a class="btn btn-warning" href="{% url 'product_update' pk=prod_pk %}" style="color: black;font-weight: bold;">Update</a>

  <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#myModal" style="font-weight: bold;">Delete</button>

  <a class="btn btn-success" style="font-weight: bold;"  onclick=download_csv(revv)>Export as csv</a>


{% endblock %}