{% extends 'product/base.html' %} 
{% block content %}
{% load staticfiles %}

<script src="https://cdn.rawgit.com/katmore/gpu-loading-overlay/master/src/loadingOverlay.js"></script>

<!-- script -->
<script type="text/javascript">
  var foo = [];
  var foo2 = [];
  var element_name = ['Base 1 (Pastel)', 'TiO2 Slurry', 'Base 2', 'Base 3', 'Base4', 'Base5', 'Base6', 'Base7', 'Base8', 'Base9'];
  var max_of_array = 0;
  var num = 0
  var pk = '{{prod_pk}}'
  var rev = '{{prod_rev}}'
  rev = parseInt(rev)+1
  var prod_currency = '{{prod_currency}}'
  console.log("prod_currency -> "+prod_currency)
  var prod_admin = '{{prod_admin}}'
  console.log("prod_admin -> "+prod_admin)
</script>

<style>
  table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
  }
</style>

<div class="main">
  <h2>{{prod_name}}</h2>
  <h4>revisione: {{prod_rev}}</h4>

  <table class="display" style="width:100%" id="tdetail">
                    <!-- thead -->
      <thead>
          <tr>
              <th style="visibility:hidden;"></th>
              <th style="visibility:hidden;"></th>
              <th style="visibility:hidden;"></th>
              {% for itemlists in list %} 
                {% for k,v in itemlists.items %}
                  {% if k == "bases" %}
                    <script type="text/javascript">
                      bases_num = "{{v|length}}"
                    </script>
                  {% endif %}
                {% endfor %}
              {% endfor %}
          </tr>
          <tr>
              <th>Raw material</th>
              <th>Specific weight [g/mL]</th>
              <th>RM cost [{{prod_currency}}/Kg]</th>

              {% for itemlists in list %}
                  {% for k,v in itemlists.items %}
                    {% if k == "bases" %}
                      <!-- script -->
                      <script type="text/javascript"> 
                        a = "{{v|length}}";
                        foo2.push(a);
                        // console.log("foo2 "+foo2);
                        max_of_array = Math.max.apply(Math, foo2);
                        // console.log("max_of_array "+max_of_array);
                      </script>
                    {% endif %}
                  {% endfor %}
                {% endfor %}
                <!-- script --> 
                <script>
                  var i;
                  for (i = 0; i < max_of_array; i++) { 
                    $("tr:nth-child(2)").append("<th>%w/w</th>");
                    $("tr:nth-child(2)").append(" <th>mL/100g</th>");
                    $("tr:nth-child(2)").append("<th>%v/v</th>");
                    $("tr:nth-child(2)").append("<th>mL/1000g</th>");
                    $("tr:nth-child(2)").append("<th>Formula Cost ["+prod_currency+"/L]</th>");     
                  }
                </script>
          </tr>
      </thead>
                    <!-- tbody -->
      <tbody>
          {% for itemlists in list %} 
          <tr>
            {% for k,v in itemlists.items %}
              {% if k != "bases" %}
              <td>{{v}}</td>
              {% endif %}
            {% endfor %}
                    <!-- show the bases -->
            {% for k,v in itemlists.items %}
              {% if k == "bases" %}
                {%for element in v%}
                  <td>{{element.g_100g}}</td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                {% endfor %} 
              {% endif %}
            {% endfor %}
          {% endfor %}
          </tr>
      </tbody>
  </table>

  <br>
  <button id="updateCalculateBtn" type="button" class="btn btn-xs" disabled = "true" onclick=generateData()>Calculate</button> 

  <br>
  <div id="tableFillCalculation" style="margin-top: 20;"></div>
  <br>
  <div id="tableMaster"></div>
  <br>

  <hr/>

  <form action='/product/save/' method='POST' id="save"> {% csrf_token %}
      <!-- <input type='hidden' name='name' /> -->
      <input type='hidden' name='pk' />
      <input type='hidden' name='data' />
      <input type='hidden' name='revision'/>
      <input type='hidden' name='currency' />
      <input id="btn_update_save" type='submit' onclick=saveProduct(rev,prod_currency) value='Save' />
  </form>
</div>
<hr/>
<script>  
  for(var i=0; i<bases_num; i++){
    $("tr:nth-child(1)").first().append("<th colspan='5'>"+element_name[i]+"</th>");
  }
</script>
<script src="{% static 'js/grid.js' %}"></script>  
<script src="{% static 'js/utils.js' %}"></script>  
<script src="{% static 'js/update.js' %}"></script>  

{% endblock %}